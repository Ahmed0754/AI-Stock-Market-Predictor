<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ“ˆ AI Stock Market Predictor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
    }
    .card, .form-control, .btn {
      background-color: #1e1e1e;
      border-color: #333;
      color: #e0e0e0;
    }
    .form-control::placeholder {
      color: #aaa;
    }
    .btn-primary {
      background-color: #03dac6;
      border-color: #03dac6;
      color: #000;
    }
    .btn-primary:hover {
      background-color: #00bfa5;
      border-color: #00bfa5;
    }
    .alert-info {
      background-color: #2a2a2a;
      border-color: #444;
      color: #cdefff;
    }
    .alert-danger {
      background-color: #3b1e1e;
      border-color: #6a1b1b;
      color: #ffcdd2;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="text-center mb-4">
      <h1 class="display-5 fw-bold text-info">ðŸ“ˆ AI Stock Market Predictor</h1>
      <p class="text-secondary">Enter a stock ticker to see predictions, moving averages, and recent performance.</p>
    </div>

    <form method="POST" class="row g-3 justify-content-center">
      <div class="col-auto">
        <input type="text" name="ticker" class="form-control" placeholder="e.g. AAPL" required />
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-primary">Predict</button>
      </div>
    </form>

    {% if error %}
    <div class="alert alert-danger mt-4 text-center">{{ error }}</div>
    {% endif %}

    {% if result %}
    <div class="alert alert-info mt-4 text-center">
      <h5>{{ result }}</h5>
    </div>

    {% if company_info %}
    <div class="card mt-3 mb-4 shadow-sm">
      <div class="card-body text-center">
        <h4>{{ company_info.longName }}</h4>
        <p>Sector: {{ company_info.sector }}</p>
        <p>Market Cap: {{ company_info.marketCap | int | format_number }}</p>
        <p>Current Price: ${{ company_info.currentPrice }}</p>
      </div>
    </div>
    {% endif %}
    {% endif %}

    {% if chart_data %}
    <div class="card mt-4 shadow-sm">
      <div class="card-body bg-dark">
        <canvas id="stockChart"></canvas>
      </div>
    </div>

    <script>
      const chartData = JSON.parse('{{ chart_data | safe }}');
      const ctx = document.getElementById('stockChart').getContext('2d');

      const data = {
        labels: chartData.dates,
        datasets: [
          {
            label: 'Close Price',
            data: chartData.close,
            borderColor: '#42a5f5',
            fill: false,
            tension: 0.1,
          },
          {
            label: '7-Day SMA',
            data: chartData.sma7,
            borderColor: '#66bb6a',
            fill: false,
            tension: 0.1,
          },
          {
            label: '30-Day SMA',
            data: chartData.sma30,
            borderColor: '#ffa726',
            fill: false,
            tension: 0.1,
          },
          {
            label: 'Predicted Next Close',
            data: Array(chartData.predictionIndex).fill(null).concat([chartData.prediction]),
            borderColor: '#ef5350',
            borderDash: [5, 5],
            pointBackgroundColor: '#ef5350',
            pointRadius: 6,
            fill: false,
          },
        ],
      };

      const config = {
        type: 'line',
        data: data,
        options: {
          plugins: {
            legend: {
              labels: {
                color: '#e0e0e0'
              }
            }
          },
          scales: {
            x: {
              ticks: { color: '#ccc' },
              title: {
                display: true,
                text: 'Date',
                color: '#ccc'
              }
            },
            y: {
              ticks: { color: '#ccc' },
              title: {
                display: true,
                text: 'Price (USD)',
                color: '#ccc'
              }
            }
          }
        }
      };

      new Chart(ctx, config);
    </script>
    {% endif %}
  </div>
</body>
</html>
